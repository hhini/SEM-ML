<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SEM + ML 实际项目论文复现</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-1d4f84655f446305ac42a8f1abcf7405.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>


</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SEM + ML 实际项目论文复现</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">JAYZJAYZ </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            GAN NAN medical university
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="sem加ml分析" class="level1">
<h1>SEM加ML分析 🫥</h1>
<hr>
<p><strong><em>要具体知道为什么要结合，可以参考文献 <a href="https://link.springer.com/article/10.1007/s40747-021-00503-w">混合人工神经网络与结构方程模型技术：综述</a>Hybrid artificial neural network and structural equation modelling techniques: a survey</em></strong></p>
<section id="为什么要结合机器学习ml与结构方程模型sem" class="level2">
<h2 class="anchored" data-anchor-id="为什么要结合机器学习ml与结构方程模型sem">为什么要结合机器学习（ML）与结构方程模型（SEM）</h2>
<section id="理论与实践的融合sem-ml-的优势" class="level3">
<h3 class="anchored" data-anchor-id="理论与实践的融合sem-ml-的优势">✨ 理论与实践的融合：SEM + ML 的优势</h3>
<p>结构方程模型（SEM）是一种强大的因果建模工具，能够同时处理测量模型（潜变量）和路径模型（变量间关系）。但在实际研究中，尤其是面对高维数据(就是变量多)、复杂变量结构或非线性关系时，SEM也面临挑战：</p>
<ul>
<li><p><strong>变量筛选困难</strong>：传统SEM依赖理论假设，变量选择主观性强(一般要参考社会科学文献，并且进行假设，麻了)；</p></li>
<li><p><strong>模型拟合受限</strong>：当变量数量多、关系复杂时，SEM模型容易过拟合或拟合不佳(过拟合和欠拟合)；</p></li>
<li><p><strong>预测能力有限</strong>：SEM更偏向解释性而非预测性。</p></li>
</ul>
<p>而机器学习（ML）正好可以补足这些短板：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>功能</th>
<th>SEM</th>
<th>ML</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>因果推理</td>
<td>✅ 强</td>
<td>❌ 弱（但可辅助）</td>
</tr>
<tr class="even">
<td>潜变量建模</td>
<td>✅ 支持</td>
<td>❌ 不直接支持</td>
</tr>
<tr class="odd">
<td>特征筛选</td>
<td>❌ 依赖理论</td>
<td>✅ 数据驱动</td>
</tr>
<tr class="even">
<td>非线性建模</td>
<td>❌ 有限</td>
<td>✅ 强大</td>
</tr>
<tr class="odd">
<td>预测能力</td>
<td>❌ 弱</td>
<td>✅ 强</td>
</tr>
</tbody>
</table>
<p>因此，将ML与SEM结合，可以实现：</p>
<ul>
<li><p><strong>数据驱动的变量筛选</strong>（如用随机森林或SHAP值找出最重要的预测因子(一般来说如果变量较多的时候，一般是不降维的，而是筛选变量的）；</p></li>
<li><p><strong>提升模型解释力与预测力</strong>（先用ML找出<strong>关键变量</strong>，再用SEM建模路径）；</p></li>
<li><p><strong>增强模型稳健性</strong>（ML可用于<strong>验证</strong>SEM模型的泛化能力）；</p></li>
<li><p><strong>提高研究影响力</strong>（结合方法更前沿，易发表在高影响因子期刊）。</p></li>
</ul>
</section>
<section id="文献支持结合ml与sem的研究越来越多影响因子也在上升" class="level3">
<h3 class="anchored" data-anchor-id="文献支持结合ml与sem的研究越来越多影响因子也在上升">📈 文献支持：结合ML与SEM的研究越来越多，影响因子也在上升</h3>
<p>以下是提供的几篇代表性文献，展示了ML+SEM的实际应用与发表潜力：</p>
<ol type="1">
<li><p>✅ <strong>复现的论文</strong>： PMC12236327</p>
<ul>
<li><p>结合随机森林与SEM，识别影响精神分裂症患者主观幸福感的关键因素。</p></li>
<li><p>通过ML筛选变量，再用lavaan构建路径模型，实现因果解释与预测并重。</p></li>
<li><p>发表在《Translational Psychiatry》，IF ≈ 7.7。</p></li>
</ul></li>
<li><p>📱 <strong>智能穿戴设备采纳研究</strong>： Bou Nassif et al.&nbsp;(2022)</p>
<ul>
<li><p>使用PLS-SEM与ML对智能手表采纳意图进行建模。</p></li>
<li><p>ML揭示“用户满意度”是最关键预测因子，SEM验证其路径关系。</p></li>
<li><p>发表在《Heliyon》，IF ≈ 4.0。</p></li>
</ul></li>
<li><p>🧠 <strong>消费者心理与行为研究</strong>： ScienceDirect 2023论文</p>
<ul>
<li><p>用ML筛选影响消费者信任的变量，再用SEM建模信任形成机制。</p></li>
<li><p>发表在《Journal of Business Research》，IF ≈ 10.0。</p></li>
</ul></li>
<li><p>🧬 <strong>健康行为预测研究</strong>： ScienceDirect 2024论文</p>
<ul>
<li><p>结合ML与SEM预测健康行为采纳，强调数据驱动与理论建模的融合。</p></li>
<li><p>发表在《Preventive Medicine Reports》，IF ≈ 3.5。</p></li>
</ul></li>
</ol>
<hr>
</section>
</section>
<section id="什么是机器学习" class="level2">
<h2 class="anchored" data-anchor-id="什么是机器学习">什么是机器学习🫤</h2>
<p>在正式进入机器学习（Machine Learning, ML）＋结构方程模型（SEM）的整合应用之前，首先要让大家对“机器学习”这个概念有一个直观的理解。不必过分纠结复杂的数学公式，而要抓住它的核心思想和研究流程。</p>
<section id="机器学习的定义" class="level3">
<h3 class="anchored" data-anchor-id="机器学习的定义">2.1 机器学习的定义🤤</h3>
<p>机器学习是一种<strong><em>让计算机通过“样本数据”自行发现规律</em></strong>，<strong><em>并将这些规律用于“预测”或“决策”的技术。</em></strong><br>
- 它不像传统统计学那样强调整体假设检验和参数估计，更注重“从数据中自动学习”。<br>
- ML 旨在用已有数据训练一个模型，让模型在新数据上也能表现出良好的预测或分类能力。</p>
<p><strong><em>这也让机器学习无法用数学公式和因果关系来知道电脑是怎么想的，形成了所谓的黑匣子，解释性太差，但是用来预测就没毛病</em></strong></p>
</section>
<section id="ml-与传统统计方法的差异" class="level3">
<h3 class="anchored" data-anchor-id="ml-与传统统计方法的差异">2.2 ML 与传统统计方法的差异🌮</h3>
<ul>
<li>目标不同
<ul>
<li>统计学：偏重解释性，解析变量间的因果或关联；<br>
</li>
<li>机器学习：偏重预测性，追求模型的泛化能力，即给我数据我可以预测出大概的，符合之前数据的答案。</li>
</ul></li>
<li>模型假设
<ul>
<li>统计模型：通常要求满足正态性、线性关系等严格假设；<br>
</li>
<li>ML 模型：对数据分布和关系的假设更弱，<strong><em>可以处理非线性、高维度数据</em></strong>。</li>
</ul></li>
<li>关注点
<ul>
<li>统计方法：估计参数、显著性检验、置信区间；<br>
</li>
<li>ML 方法：<strong><em>模型选择、交叉验证、过拟合控制、预测误差</em></strong>。</li>
</ul></li>
</ul>
</section>
<section id="机器学习的主要类型" class="level3">
<h3 class="anchored" data-anchor-id="机器学习的主要类型">2.3 机器学习的主要类型🤖</h3>
<ol type="1">
<li><strong>监督学习（Supervised Learning）</strong>
<ul>
<li>有“标签”的数据（例如：患者有/无压力性损伤）。<br>
</li>
<li>常见算法：逻辑回归、决策树、随机森林、支持向量机、神经网络等。<br>
</li>
<li>核心任务：分类（Classification）和回归（Regression）。</li>
</ul></li>
<li><strong>无监督学习（Unsupervised Learning）</strong>
<ul>
<li>无标签数据。<br>
</li>
<li>常见算法：聚类（K-means、层次聚类）、降维（PCA、t-SNE）。<br>
</li>
<li>核心任务：发现数据的内在结构、分群、特征降维。</li>
</ul></li>
<li><strong>强化学习（Reinforcement Learning）</strong>
<ul>
<li>通过“试错”与环境互动来学习最优策略。<br>
</li>
<li>在护理研究中应用相对少，可用于优化护理路径或资源调度。</li>
</ul></li>
</ol>
</section>
<section id="机器学习研究流程" class="level3">
<h3 class="anchored" data-anchor-id="机器学习研究流程">2.4 机器学习研究流程🛫</h3>
<ol type="1">
<li><strong>数据准备与清洗</strong>
<ul>
<li>汇总临床指标、问卷量表、电子健康记录等；<br>
</li>
<li>处理缺失值、异常值、分类变量编码。</li>
</ul></li>
<li><strong>特征工程</strong>
<ul>
<li>选择或构造与研究目标最相关的变量（特征）即挑选重要的特征变量，过滤不需要的变量；<br>
</li>
<li>归一化、标准化、one-hot 编码(独热编码)等。</li>
</ul></li>
<li><strong>模型训练与优化</strong>
<ul>
<li>在“训练集”上训练模型；<br>
</li>
<li>通过交叉验证（Cross-Validation）选择超参数，<strong>防止过拟合</strong>(过拟合即是对模型来说，学习太多不重要的特征，比如我训练了一个识别学长还是学姐的模型，但是模型学习到了几个女装的学长，本来女装这是几个人的特殊癖好，但是模型认为女装的都是学长，这扯不扯）。</li>
</ul></li>
<li><strong>模型评估</strong>
<ul>
<li><strong><em>在“测试集”或“留出数据”上评估预测性能</em></strong>，这也是为什么机器学习都要分成训练集和验证集，要么7/3,要么8/2等等（千万别耍小聪明，觉得数据不够多，还要拆分，耍滑头把所有数据都拿去训练，然后再拿其中一部分来预测，因为模型有记忆的，你预测训练过的数据，肯定准确率是百分百，就好像你明明知道明天的天气，那为什么要根据之前的数据推测呢）（如 AUC、准确率、RMSE）；<br>
</li>
<li>比较不同算法的优劣。</li>
</ul></li>
<li><strong>模型解释与应用</strong>
<ul>
<li><p>使用 SHAP、LIME 等方法<strong>解释模型</strong></p>
<p>它们是两种常用的“模型解释工具”，可以告诉我们：<strong>哪些变量对模型预测最重要，以及它们的影响方向</strong></p></li>
</ul></li>
</ol>
<hr>
</section>
</section>
<section id="复现一篇论文" class="level2">
<h2 class="anchored" data-anchor-id="复现一篇论文">复现一篇论文🤖</h2>
<p><strong><code>最好学习的方法就是看相关论文，然后学习论文知识，然后复现学习，所以啥也不说了，直接真刀真枪开干就完了</code></strong></p>
<section id="replicating-research-on-subjective-well-being-in-schizophrenia-a-guide-to-generating-synthetic-data-for-sem-and-machine-learning-精神分裂症患者主观幸福感研究sem-和机器学习合成数据生成指南论文链接" class="level4">
<h4 class="anchored" data-anchor-id="replicating-research-on-subjective-well-being-in-schizophrenia-a-guide-to-generating-synthetic-data-for-sem-and-machine-learning-精神分裂症患者主观幸福感研究sem-和机器学习合成数据生成指南论文链接">Replicating Research on Subjective Well-Being in Schizophrenia: A Guide to Generating Synthetic Data for SEM and Machine Learning 精神分裂症患者主观幸福感研究：SEM 和机器学习合成数据生成指南<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC12236327/#s5">论文链接</a></h4>
<p><strong><em>！现在我不以社会科学的角度解析这篇文章，只用统计学和代码来解析如何处理</em></strong></p>
<p>因为我现在没有相关的数据，所以我只能用代码模拟和文章差不多的数据</p>
<ul>
<li><p><strong>表 1：机器学习模型中包含的独立变量列表：</strong> 该表概述了分析中使用的所有变量，包括社会人口因素（年龄、性别、教育、职业）、疾病相关因素（疾病持续时间）和各种临床测量。</p></li>
<li><p><strong>表 2：样本特征：</strong>提供了 637 名患者原始数据集中变量的描述性统计数据。它包括连续变量的平均值、标准差和范围，以及分类变量的频率。</p></li>
<li><p><strong>图 3：网络模型和中心性指标：</strong>展示了不同变量之间的相关性。连接及其粗细表示关系的强度，这应该反映在合成数据的相关矩阵中。</p></li>
<li><p><strong>图 4：结构方程模型（SEM）分析：</strong> 该图比网络分析更进一步，揭示了变量之间的因果路径和效应方向。路径系数量化了这些关系的强度和方向。</p></li>
</ul>
</section>
<section id="使用-python-生成合成数据" class="level4">
<h4 class="anchored" data-anchor-id="使用-python-生成合成数据">使用 Python 生成合成数据</h4>
<p>以下 Python 代码演示了如何生成一个与论文中描述的特征近似的合成数据集。此代码使用 numpy 和 pandas 库创建一个数据框，其中包含与原始研究中的变量具有相似统计特性和相关性的变量。变量不用Chinese</p>
<div id="e0fd4629" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入所需的库</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入所需的库</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> truncnorm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. 定义样本量 ---</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>n_patients <span class="op">=</span> <span class="dv">637</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. 基于SEM和网络分析生成核心相关数据 ---</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> np.array([</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SWB,   OCS,   Som,   Cog,   Dep,   Neg,   Pos,   PSP</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.00</span>, <span class="op">-</span><span class="fl">0.59</span>, <span class="op">-</span><span class="fl">0.40</span>, <span class="op">-</span><span class="fl">0.20</span>, <span class="op">-</span><span class="fl">0.35</span>, <span class="op">-</span><span class="fl">0.25</span>, <span class="op">-</span><span class="fl">0.15</span>,  <span class="fl">0.30</span>],</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    [<span class="op">-</span><span class="fl">0.59</span>,  <span class="fl">1.00</span>,  <span class="fl">0.70</span>,  <span class="fl">0.30</span>,  <span class="fl">0.40</span>,  <span class="fl">0.20</span>,  <span class="fl">0.18</span>, <span class="op">-</span><span class="fl">0.25</span>],</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    [<span class="op">-</span><span class="fl">0.40</span>,  <span class="fl">0.70</span>,  <span class="fl">1.00</span>,  <span class="fl">0.25</span>,  <span class="fl">0.35</span>,  <span class="fl">0.15</span>,  <span class="fl">0.10</span>, <span class="op">-</span><span class="fl">0.20</span>],</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    [<span class="op">-</span><span class="fl">0.20</span>,  <span class="fl">0.30</span>,  <span class="fl">0.25</span>,  <span class="fl">1.00</span>,  <span class="fl">0.26</span>,  <span class="fl">0.48</span>,  <span class="fl">0.36</span>, <span class="op">-</span><span class="fl">0.40</span>],</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    [<span class="op">-</span><span class="fl">0.35</span>,  <span class="fl">0.40</span>,  <span class="fl">0.35</span>,  <span class="fl">0.26</span>,  <span class="fl">1.00</span>,  <span class="fl">0.35</span>,  <span class="fl">0.24</span>, <span class="op">-</span><span class="fl">0.50</span>],</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    [<span class="op">-</span><span class="fl">0.25</span>,  <span class="fl">0.20</span>,  <span class="fl">0.15</span>,  <span class="fl">0.48</span>,  <span class="fl">0.35</span>,  <span class="fl">1.00</span>,  <span class="fl">0.22</span>, <span class="op">-</span><span class="fl">0.60</span>],</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    [<span class="op">-</span><span class="fl">0.15</span>,  <span class="fl">0.18</span>,  <span class="fl">0.10</span>,  <span class="fl">0.36</span>,  <span class="fl">0.24</span>,  <span class="fl">0.22</span>,  <span class="fl">1.00</span>, <span class="op">-</span><span class="fl">0.30</span>],</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    [ <span class="fl">0.30</span>, <span class="op">-</span><span class="fl">0.25</span>, <span class="op">-</span><span class="fl">0.20</span>, <span class="op">-</span><span class="fl">0.40</span>, <span class="op">-</span><span class="fl">0.50</span>, <span class="op">-</span><span class="fl">0.60</span>, <span class="op">-</span><span class="fl">0.30</span>,  <span class="fl">1.00</span>]</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> np.zeros(correlation_matrix.shape[<span class="dv">0</span>])</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>correlated_data <span class="op">=</span> np.random.multivariate_normal(mean, correlation_matrix, size<span class="op">=</span>n_patients)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. 缩放和转换数据以匹配论文表2中的统计特征 ---</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scale_variable(data_column, mean, std, min_val, max_val):</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    scaled <span class="op">=</span> data_column <span class="op">*</span> std <span class="op">+</span> mean</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.clip(scaled, min_val, max_val)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>cgi_pos <span class="op">=</span> scale_variable(correlated_data[:, <span class="dv">6</span>], <span class="fl">3.7</span>, <span class="fl">1.4</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>cgi_neg <span class="op">=</span> scale_variable(correlated_data[:, <span class="dv">5</span>], <span class="fl">3.3</span>, <span class="fl">1.2</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>cgi_dep <span class="op">=</span> scale_variable(correlated_data[:, <span class="dv">4</span>], <span class="fl">2.6</span>, <span class="fl">1.2</span>, <span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>cgi_cog <span class="op">=</span> scale_variable(correlated_data[:, <span class="dv">3</span>], <span class="fl">3.1</span>, <span class="fl">1.1</span>, <span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>scl_som <span class="op">=</span> scale_variable(correlated_data[:, <span class="dv">2</span>], <span class="fl">21.3</span>, <span class="fl">8.7</span>, <span class="dv">12</span>, <span class="dv">58</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>scl_ocs <span class="op">=</span> scale_variable(correlated_data[:, <span class="dv">1</span>], <span class="fl">22.4</span>, <span class="fl">8.3</span>, <span class="dv">10</span>, <span class="dv">50</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>swn_total <span class="op">=</span> scale_variable(correlated_data[:, <span class="dv">0</span>], <span class="fl">73.5</span>, <span class="fl">17.6</span>, <span class="dv">24</span>, <span class="dv">120</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>psp_total <span class="op">=</span> scale_variable(correlated_data[:, <span class="dv">7</span>], <span class="fl">55.9</span>, <span class="fl">14.8</span>, <span class="dv">10</span>, <span class="dv">90</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>diepss_severity <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">4</span>, n_patients)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>diepss_severity <span class="op">=</span> np.clip(diepss_severity, <span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>diepss_severity_mean <span class="op">=</span> np.mean(diepss_severity)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>diepss_severity <span class="op">=</span> (diepss_severity <span class="op">-</span> diepss_severity_mean) <span class="op">*</span> (<span class="fl">0.8</span> <span class="op">/</span> np.std(diepss_severity)) <span class="op">+</span> <span class="fl">0.6</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>diepss_severity <span class="op">=</span> np.clip(diepss_severity, <span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. 生成社会人口统计学及其他变量 ---</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>age_mean, age_std, age_min, age_max <span class="op">=</span> <span class="fl">35.7</span>, <span class="fl">10.5</span>, <span class="dv">18</span>, <span class="dv">64</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>age <span class="op">=</span> truncnorm.rvs((age_min <span class="op">-</span> age_mean) <span class="op">/</span> age_std, (age_max <span class="op">-</span> age_mean) <span class="op">/</span> age_std, loc<span class="op">=</span>age_mean, scale<span class="op">=</span>age_std, size<span class="op">=</span>n_patients)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>sex <span class="op">=</span> np.random.choice([<span class="dv">1</span>, <span class="dv">0</span>], size<span class="op">=</span>n_patients, p<span class="op">=</span>[<span class="fl">0.529</span>, <span class="fl">0.471</span>])</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>education <span class="op">=</span> np.random.choice([<span class="st">'Less than 12 years'</span>, <span class="st">'High school'</span>, <span class="st">'College or graduate'</span>], size<span class="op">=</span>n_patients, p<span class="op">=</span>[<span class="fl">0.171</span>, <span class="fl">0.413</span>, <span class="fl">0.416</span>])</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>occupation <span class="op">=</span> np.random.choice([<span class="dv">1</span>, <span class="dv">0</span>], size<span class="op">=</span>n_patients, p<span class="op">=</span>[<span class="fl">0.174</span>, <span class="fl">0.826</span>])</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>illness_duration_mean, illness_duration_std, illness_duration_min, illness_duration_max <span class="op">=</span> <span class="fl">9.1</span>, <span class="fl">8.1</span>, <span class="dv">0</span>, <span class="dv">44</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>illness_duration <span class="op">=</span> truncnorm.rvs((illness_duration_min <span class="op">-</span> illness_duration_mean) <span class="op">/</span> illness_duration_std, (illness_duration_max <span class="op">-</span> illness_duration_mean) <span class="op">/</span> illness_duration_std, loc<span class="op">=</span>illness_duration_mean, scale<span class="op">=</span>illness_duration_std, size<span class="op">=</span>n_patients)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>obesity <span class="op">=</span> np.random.choice([<span class="dv">1</span>, <span class="dv">0</span>], size<span class="op">=</span>n_patients, p<span class="op">=</span>[<span class="fl">0.468</span>, <span class="fl">0.532</span>])</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>hypertension <span class="op">=</span> np.random.choice([<span class="dv">1</span>, <span class="dv">0</span>], size<span class="op">=</span>n_patients, p<span class="op">=</span>[<span class="fl">0.273</span>, <span class="fl">0.727</span>])</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>diabetes <span class="op">=</span> np.random.choice([<span class="dv">1</span>, <span class="dv">0</span>], size<span class="op">=</span>n_patients, p<span class="op">=</span>[<span class="fl">0.154</span>, <span class="fl">0.846</span>])</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. 组合成 Pandas DataFrame ---</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>synthetic_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Age'</span>: age.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sex_Female'</span>: sex,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Education'</span>: education,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Occupation_Employed'</span>: occupation,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Duration_of_Illness'</span>: illness_duration.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Obesity'</span>: obesity,</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Hypertension'</span>: hypertension,</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Diabetes'</span>: diabetes,</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CGI_Positive'</span>: cgi_pos.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CGI_Negative'</span>: cgi_neg.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CGI_Depressive'</span>: cgi_dep.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CGI_Cognitive'</span>: cgi_cog.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SCL90R_Somatization'</span>: scl_som.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SCL90R_OCS'</span>: scl_ocs.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SWN_Total_Score'</span>: swn_total.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DIEPSS_Overall_Severity'</span>: diepss_severity.<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PSP_Total_Score'</span>: psp_total.<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6. 将数据框 (DataFrame) 保存为 CSV 文件 ---</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="co"># !!! 重要提示: 请将下面的路径修改为您希望保存文件的实际位置 !!!</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 例如 Windows: "C:/Users/用户名/Documents/synthetic_data.csv"</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 例如 macOS: "/Users/用户名/Documents/synthetic_data.csv"</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"./synthetic_schizophrenia_data.csv"</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 to_csv() 函数来保存数据</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="co"># 参数 index=False 的意思是，数据框的行索引 (0, 1, 2, ...) 不会被写入到 CSV 文件中</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>synthetic_df.to_csv(file_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(synthetic_df.head(<span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Age  Sex_Female            Education  Occupation_Employed  \
0  21.5           1          High school                    0   
1  29.3           0          High school                    0   
2  48.7           0  College or graduate                    0   
3  18.9           1          High school                    0   
4  28.2           0          High school                    1   
5  53.8           1   Less than 12 years                    1   
6  39.2           0          High school                    0   
7  30.0           1          High school                    1   
8  22.8           0          High school                    1   
9  20.4           1          High school                    0   

   Duration_of_Illness  Obesity  Hypertension  Diabetes  CGI_Positive  \
0                 13.7        0             0         0           2.7   
1                 16.2        0             0         0           3.3   
2                 11.0        1             0         1           4.7   
3                 12.1        1             0         0           4.0   
4                  5.0        1             1         0           3.5   
5                  6.6        1             0         0           3.9   
6                  4.2        0             1         0           4.8   
7                  5.9        1             0         0           2.3   
8                  5.4        0             0         0           3.0   
9                 10.8        1             0         0           5.1   

   CGI_Negative  CGI_Depressive  CGI_Cognitive  SCL90R_Somatization  \
0           5.1             2.8            4.0                 23.6   
1           1.1             2.7            3.5                 17.5   
2           1.7             1.8            1.8                 14.4   
3           2.1             1.8            3.5                 17.2   
4           2.8             4.0            3.5                 12.0   
5           3.1             4.1            3.9                 26.0   
6           5.1             3.4            3.3                 14.7   
7           2.6             1.6            3.4                 20.2   
8           3.5             2.8            3.8                 28.0   
9           1.6             1.4            4.0                 36.0   

   SCL90R_OCS  SWN_Total_Score  DIEPSS_Overall_Severity  PSP_Total_Score  
0        27.8             75.3                      0.0             59.8  
1        19.3             65.1                      1.1             61.6  
2        12.9             61.6                      1.9             71.8  
3        26.7             92.3                      0.0             64.4  
4        15.6             69.6                      1.5             41.9  
5        30.6             80.2                      0.0             48.2  
6        19.3             92.1                      0.7             42.7  
7        12.2             87.2                      0.0             57.5  
8        39.0             56.1                      1.8             61.8  
9        25.8             62.3                      1.4             81.9  </code></pre>
</div>
</div>
</section>
<section id="数据维度" class="level3">
<h3 class="anchored" data-anchor-id="数据维度">🧮 数据维度</h3>
<ul>
<li><p><strong>样本数（行数）</strong>：<code>637</code> 由 <code>n_patients = 637</code> 指定，模拟的是637位精神分裂症患者的临床与人口学数据。</p></li>
<li><p><strong>变量数（列数）</strong>：<code>17</code> 包括临床症状、人口学特征、功能状态和代谢指标等变量。</p></li>
</ul>
</section>
<section id="变量列表与类型" class="level3">
<h3 class="anchored" data-anchor-id="变量列表与类型">📊 变量列表与类型</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>变量名</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Age</code></td>
<td>连续变量</td>
<td>年龄（18–64岁）</td>
</tr>
<tr class="even">
<td><code>Sex_Female</code></td>
<td>二元变量</td>
<td>性别（1=女性，0=男性）</td>
</tr>
<tr class="odd">
<td><code>Education</code></td>
<td>分类变量</td>
<td>教育水平（3类）</td>
</tr>
<tr class="even">
<td><code>Occupation_Employed</code></td>
<td>二元变量</td>
<td>是否就业（1=在职）</td>
</tr>
<tr class="odd">
<td><code>Duration_of_Illness</code></td>
<td>连续变量</td>
<td>病程（0–44年）</td>
</tr>
<tr class="even">
<td><code>Obesity</code></td>
<td>二元变量</td>
<td>是否肥胖</td>
</tr>
<tr class="odd">
<td><code>Hypertension</code></td>
<td>二元变量</td>
<td>是否高血压</td>
</tr>
<tr class="even">
<td><code>Diabetes</code></td>
<td>二元变量</td>
<td>是否糖尿病</td>
</tr>
<tr class="odd">
<td><code>CGI_Positive</code></td>
<td>连续变量</td>
<td>阳性症状评分（1–7）</td>
</tr>
<tr class="even">
<td><code>CGI_Negative</code></td>
<td>连续变量</td>
<td>阴性症状评分（1–7）</td>
</tr>
<tr class="odd">
<td><code>CGI_Depressive</code></td>
<td>连续变量</td>
<td>抑郁症状评分（1–6）</td>
</tr>
<tr class="even">
<td><code>CGI_Cognitive</code></td>
<td>连续变量</td>
<td>认知缺陷评分（1–6）</td>
</tr>
<tr class="odd">
<td><code>SCL90R_Somatization</code></td>
<td>连续变量</td>
<td>躯体化评分（12–58）</td>
</tr>
<tr class="even">
<td><code>SCL90R_OCS</code></td>
<td>连续变量</td>
<td>强迫症状评分（10–50）</td>
</tr>
<tr class="odd">
<td><code>SWN_Total_Score</code></td>
<td>连续变量</td>
<td>主观幸福感评分（24–120）</td>
</tr>
<tr class="even">
<td><code>DIEPSS_Overall_Severity</code></td>
<td>连续变量</td>
<td>锥体外系不良反应评分（0–4）</td>
</tr>
<tr class="odd">
<td><code>PSP_Total_Score</code></td>
<td>连续变量</td>
<td>社会功能评分（10–90）</td>
</tr>
</tbody>
</table>
</section>
<section id="变量探索机器学习进行变量的探索即特征工程" class="level3">
<h3 class="anchored" data-anchor-id="变量探索机器学习进行变量的探索即特征工程">📊 变量探索(机器学习进行变量的探索，即特征工程)</h3>
<hr>
<p><strong>论文的首要分析步骤是利用机器学习 (ML) 来识别决定高水平主观幸福感 (SWB) 的最重要因素。论文作者训练了多个模型，发现随机森林 (RF) 模型表现最佳</strong></p>
<ol type="1">
<li><p>准备机器学习的数据 。</p></li>
<li><p>训练随机森林模型来预测哪些患者具有“高水平的 SWB”。</p></li>
<li><p>使用 AUC 指标评估模型的性能 ，就像论文中所做的那样。</p></li>
<li><p>使用 SHAP 值分析<strong>特征重要性</strong>， 以了解哪些变量是最强大的预测因子，重现论文中图 1B 中的发现。</p></li>
</ol>
<section id="第一步导入需要的包" class="level4">
<h4 class="anchored" data-anchor-id="第一步导入需要的包">第一步导入需要的包🧉</h4>
<ul>
<li>包是可以认为是游戏的mod,都是大佬收集的算法或者其他的代码来实现你需要的功能，这些都是地基</li>
</ul>
<div id="a9e49ee8" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入所需的库</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                 <span class="co"># 导入 pandas 用于读取和处理数据</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                  <span class="co"># 导入 numpy 用于数值计算</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># 导入 train_test_split 用于划分训练集和测试集</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier  <span class="co"># 导入随机森林分类器</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, roc_curve <span class="co"># 导入评估指标计算函数</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt     <span class="co"># 导入 matplotlib 用于绘图</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap                         <span class="co"># 导入 SHAP 库用于模型解释</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="第二步导入数据" class="level4">
<h4 class="anchored" data-anchor-id="第二步导入数据">第二步导入数据🤤</h4>
<p>就是我们要的数据，即调查的数据，一般是XLSX(excel表格)，csv(数据格式万金油)，或者其他格式</p>
<div id="60cd683f" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. 加载并准备数据 ---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and Prepare the Data</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># !!! 重要提示: 请将下面的路径修改为您保存 CSV 文件的实际位置 !!!</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For example: "C:/Users/YourUsername/Documents/synthetic_schizophrenia_data.csv"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"./synthetic_schizophrenia_data.csv"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取我们之前生成的合成数据</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(file_path)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="第三步-定义目标变量和特征变量" class="level4">
<h4 class="anchored" data-anchor-id="第三步-定义目标变量和特征变量">第三步 定义目标变量和特征变量🥶</h4>
<p>我们必须要知道what the fuck is our 目标变量，即我们要研究的目标，这篇文章研究的是 <strong>高水平主观幸福感 (SWB)</strong>，他们想要知道什么因素影响这个鬼东西，而这些因素，比如年龄，身高，体重就是特征变量</p>
<ul>
<li><strong>定义目标</strong>： 本文机器学习模型的主要目标并非预测准确的主观幸福感 (SWB) 评分，而是将患者分为两组：具有“高水平 SWB”的患者和不具有“高水平 SWB”的患者。我们遵循本文的思路，创建了一个二元目标变量 ( High_SWB )，其中 80 分及以上被视为“高”（编码为 1），低于 80 分则被视为“低”（编码为 0）。</li>
</ul>
<div id="feddb7cd" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 定义目标变量 (Y)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据论文，"高水平SWB" 定义为 SWN 总分达到或超过 80</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 我们创建一个名为 'High_SWB' 的新列，1 表示高SWB，0 表示非高SWB</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'High_SWB'</span>] <span class="op">=</span> (df[<span class="st">'SWN_Total_Score'</span>] <span class="op">&gt;=</span> <span class="dv">80</span>).astype(<span class="bu">int</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 定义特征变量 (X)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># X 是除了目标变量和原始SWN分数之外的所有列</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We drop the original score and the target variable to create our feature set</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop([<span class="st">'SWN_Total_Score'</span>, <span class="st">'High_SWB'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'High_SWB'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p>测试代码，和项目没关系</p>
<div id="962ed603" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>100</code></pre>
</div>
</div>
<div id="05217f28" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"nihao"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>nihao</code></pre>
</div>
</div>
<div id="2a706115" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Hello world"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello world</code></pre>
</div>
</div>
<div id="44b194a9" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Feature A'</span>: np.random.normal(loc<span class="op">=</span><span class="dv">0</span>, scale<span class="op">=</span><span class="dv">1</span>, size<span class="op">=</span>n),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Feature B'</span>: np.random.normal(loc<span class="op">=</span><span class="dv">5</span>, scale<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>n),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Feature C'</span>: np.random.normal(loc<span class="op">=-</span><span class="dv">3</span>, scale<span class="op">=</span><span class="fl">1.5</span>, size<span class="op">=</span>n),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Class'</span>: np.random.choice([<span class="st">'Class 1'</span>, <span class="st">'Class 2'</span>, <span class="st">'Class 3'</span>], size<span class="op">=</span>n)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize with seaborn pairplot</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> sns.pairplot(data, hue<span class="op">=</span><span class="st">'Class'</span>, palette<span class="op">=</span><span class="st">'Set2'</span>, diag_kind<span class="op">=</span><span class="st">'kde'</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Synthetic Data Visualization"</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-1.png" width="817" height="738" class="figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>